<div class="bg-[url('assets/svgs/subscription-bg.svg')] bg-cover bg-center px-4 py-10 md:py-16 lg:py-28">
  <div
    class="max-w-5xl mx-auto flex  flex-col lg:flex-row rounded-xl overflow-hidden shadow-[0px_0px_52px_0px_#B9A9CD33] border border-[#BFB8D7]">
    <!-- Left side - Form -->
    <div class="flex-1 bg-white p-8 flex flex-col gap-4">
      <div class="">
        <h2 class="text-2xl font-bold mb-2 text-[#202124]">Subscribe</h2>
        <p class="text-[#202124]">to our Monthly Surprise Box</p>
      </div>

      <hr class="">

      <form [formGroup]="subscriptionForm" (ngSubmit)="onSubmit()" class="space-y-8">
        <div class="flex flex-col gap-8">
          <!-- Contact Information -->
          <div formGroupName="contactInfo" class="space-y-4">
            <h3 class="text-xl font-bold text-[#202124] mb-2">Contact Information</h3>

            <div class="space-y-2">
              <label for="parentName" class="block text-sm font-medium text-gray-700">Your Name</label>
              <input id="parentName" type="text" formControlName="name" placeholder="e.g Salama Abdullah"
                [class]="'w-full p-3 border rounded-lg focus:outline-none bg-white text-[#202124] ' + 
                (isFieldInvalid('contactInfo.name') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
              <p *ngIf="isFieldInvalid('contactInfo.name')" class="mt-1 text-sm text-red-500">
                {{ getErrorMessage(subscriptionForm.get('contactInfo.name'), 'name') }}
              </p>
            </div>

            <div class="space-y-2">
              <label for="parentEmail" class="block text-sm font-medium text-gray-700">Email</label>
              <input id="parentEmail" type="email" formControlName="email" placeholder="Example@gmail.com"
                [class]="'w-full p-3 border rounded-lg focus:outline-none bg-white text-[#202124] ' + 
                (isFieldInvalid('contactInfo.email') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
              <p *ngIf="isFieldInvalid('contactInfo.email')" class="mt-1 text-sm text-red-500">
                {{ getErrorMessage(subscriptionForm.get('contactInfo.email'), 'email') }}
              </p>
            </div>
          </div>

          <!-- Child's Information -->
          <div formGroupName="childInfo" class="space-y-4">
            <h3 class="text-xl font-bold text-[#202124] mb-2">Child's Information</h3>

            <div class="space-y-2">
              <label for="childName" class="block text-sm font-medium text-gray-700">Child's Full Name</label>
              <input id="childName" type="text" formControlName="fullName" placeholder="e.g Sarah Mohammed"
                [class]="'w-full p-3 border rounded-lg focus:outline-none bg-white text-[#202124] ' + 
                (isFieldInvalid('childInfo.fullName') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
              <p *ngIf="isFieldInvalid('childInfo.fullName')" class="mt-1 text-sm text-red-500">
                {{ getErrorMessage(subscriptionForm.get('childInfo.fullName'), 'fullName') }}
              </p>
            </div>

            <div formGroupName="dateOfBirth" class="space-y-2">
              <label for="birthDay" class="block text-sm font-medium text-gray-700">Child's Date of Birth</label>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <div class="relative">
                    <select id="birthDay" formControlName="day"
                      [class]="'w-full p-3 pr-10 border rounded-lg focus:outline-none bg-white text-gray-500 appearance-none ' + 
                    (isFieldInvalid('childInfo.dateOfBirth.day') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
                      <option value="" disabled selected>Day</option>
                      <option *ngFor="let day of availableDays" [value]="day">{{day.toString().padStart(2, '0')}}
                      </option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </div>
                  <p *ngIf="isFieldInvalid('childInfo.dateOfBirth.day')" class="text-sm text-red-500">
                    {{ getErrorMessage(subscriptionForm.get('childInfo.dateOfBirth.day'), 'day') }}
                  </p>
                </div>

                <div>
                  <div class="relative">
                    <select id="birthMonth" formControlName="month"
                      [class]="'w-full p-3 pr-10 border rounded-lg focus:outline-none bg-white text-gray-500 appearance-none ' + 
                      (isFieldInvalid('childInfo.dateOfBirth.month') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
                      <option value="" disabled selected>Month</option>
                      <option *ngFor="let month of months" [value]="month.value">{{month.name}}</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </div>
                  <p *ngIf="isFieldInvalid('childInfo.dateOfBirth.month')" class="text-sm text-red-500">
                    {{ getErrorMessage(subscriptionForm.get('childInfo.dateOfBirth.month'), 'month') }}
                  </p>
                </div>

                <div>
                  <div class="relative">
                    <select id="birthYear" formControlName="year"
                      [class]="'w-full p-3 pr-10 border rounded-lg focus:outline-none bg-white text-gray-500 appearance-none ' + 
                      (isFieldInvalid('childInfo.dateOfBirth.year') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
                      <option value="" disabled selected>Year</option>
                      <option *ngFor="let year of availableYears" [value]="year">{{year}}</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                  </div>
                  <p *ngIf="isFieldInvalid('childInfo.dateOfBirth.year')" class="text-sm text-red-500">
                    {{ getErrorMessage(subscriptionForm.get('childInfo.dateOfBirth.year'), 'year') }}
                  </p>
                </div>

              </div>
            </div>

            <div class="space-y-2">
              <label for="grade" class="block text-sm font-medium text-gray-700">Grade</label>
              <select id="grade" formControlName="grade"
                [class]="'w-full p-3 border rounded-lg focus:outline-none bg-white text-[#202124] ' + 
                (isFieldInvalid('childInfo.grade') ? 'border-red-500 focus:ring-red-500' : 'focus:ring-2 focus:ring-primary border-gray-300')">
                <option value="">e.g Grade 2</option>
                <option *ngFor="let grade of [].constructor(12); let i = index" [value]="'Grade ' + (i + 1)">Grade {{i +
                  1}}
                </option>
              </select>
              <p *ngIf="isFieldInvalid('childInfo.grade')" class="mt-1 text-sm text-red-500">
                {{ getErrorMessage(subscriptionForm.get('childInfo.grade'), 'grade') }}
              </p>
            </div>

            <div class="space-y-2">
              <label id="genderLabel" class="block text-sm font-medium text-gray-700">Gender</label>
              <div class="grid grid-cols-2 gap-4" role="group" aria-labelledby="genderLabel">
                <button type="button" [class]="'w-full py-2.5 px-3.5 rounded-lg border border-solid flex justify-between items-center transition-colors ' + 
                  (subscriptionForm.get('childInfo.gender')?.value === 'Boy' ? 
                  'border-primary text-primary bg-[#F4F1FE]' : 'border-gray-300 bg-white text-[#202124]') + 
                  (isFieldInvalid('childInfo.gender') ? ' border-red-500' : '')"
                  (click)="subscriptionForm.patchValue({childInfo: {gender: 'Boy'}})" id="genderBoy"
                  [attr.aria-pressed]="subscriptionForm.get('childInfo.gender')?.value === 'Boy'">
                  Boy
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M8 1.33337C4.31999 1.33337 1.33333 4.32004 1.33333 8.00004C1.33333 11.68 4.31999 14.6667 8 14.6667C11.68 14.6667 14.6667 11.68 14.6667 8.00004C14.6667 4.32004 11.68 1.33337 8 1.33337ZM8 13.3334C5.06 13.3334 2.66666 10.94 2.66666 8.00004C2.66666 5.06004 5.06 2.66671 8 2.66671C10.94 2.66671 13.3333 5.06004 13.3333 8.00004C13.3333 10.94 10.94 13.3334 8 13.3334ZM11.06 5.05337L6.66666 9.44671L4.93999 7.72671L3.99999 8.66671L6.66666 11.3334L12 6.00004L11.06 5.05337Z"
                      [attr.fill]="subscriptionForm.get('childInfo.gender')?.value === 'Boy' ?  '#896af9 ' : '#D0D5DD'" />
                  </svg>
                </button>
                <button type="button" [class]="'w-full py-2.5 px-3.5 rounded-lg border border-solid flex justify-between items-center transition-colors ' + 
                  (subscriptionForm.get('childInfo.gender')?.value === 'Girl' ? 
                  'border-primary text-primary bg-[#F4F1FE]' : 'border-gray-300 bg-white text-[#202124]') + 
                  (isFieldInvalid('childInfo.gender') ? ' border-red-500' : '')"
                  (click)="subscriptionForm.patchValue({childInfo: {gender: 'Girl'}})" id="genderGirl"
                  [attr.aria-pressed]="subscriptionForm.get('childInfo.gender')?.value === 'Girl'">
                  Girl
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M8 1.33337C4.31999 1.33337 1.33333 4.32004 1.33333 8.00004C1.33333 11.68 4.31999 14.6667 8 14.6667C11.68 14.6667 14.6667 11.68 14.6667 8.00004C14.6667 4.32004 11.68 1.33337 8 1.33337ZM8 13.3334C5.06 13.3334 2.66666 10.94 2.66666 8.00004C2.66666 5.06004 5.06 2.66671 8 2.66671C10.94 2.66671 13.3333 5.06004 13.3333 8.00004C13.3333 10.94 10.94 13.3334 8 13.3334ZM11.06 5.05337L6.66666 9.44671L4.93999 7.72671L3.99999 8.66671L6.66666 11.3334L12 6.00004L11.06 5.05337Z"
                      [attr.fill]="subscriptionForm.get('childInfo.gender')?.value === 'Girl' ?  '#896af9 ' : '#D0D5DD'" />
                  </svg>
                </button>
              </div>
              <p *ngIf="isFieldInvalid('childInfo.gender')" class="mt-1 text-sm text-red-500">
                {{ getErrorMessage(subscriptionForm.get('childInfo.gender'), 'gender') }}
              </p>
            </div>
          </div>

          <!-- Topics Selection -->
          <div class="space-y-4">
            <h3 id="topicsLabel" class="text-xl font-bold text-[#202124] mb-2">As a parent select any 3 topics</h3>
            <div class="flex flex-wrap gap-3" role="group" aria-labelledby="topicsLabel">
              <button type="button" *ngFor="let topic of topics; let i = index" [id]="'topic' + i" [class]="'px-5 py-1 rounded-full border transition-colors border-solid ' + 
                (isTopicSelected(topic) ? 'bg-[#F4F1FE] text-[#6633FF]  border-[#6633FF]' : 'bg-white text-gray-500  border-[#E1E3E6]') + 
                (isFieldInvalid('selectedTopics') ? ' border-red-500' : '')" (click)="onTopicSelect(topic)"
                [attr.aria-pressed]="isTopicSelected(topic)">
                {{topic}}
              </button>
            </div>
            <p *ngIf="isFieldInvalid('selectedTopics')" class="mt-1 text-sm text-red-500">
              {{ getErrorMessage(subscriptionForm.get('selectedTopics'), 'selectedTopics') }}
            </p>
          </div>
        </div>

        <div class="flex justify-center">
          <app-subscribe-button class="w-full" [buttonText]="'Continue to payment'" (onClick)="onSubmit()"
            [isLoading]="isLoading">
          </app-subscribe-button>
        </div>
      </form>
    </div>

    <!-- Right side - Summary -->
    <div class="lg:w-1/3 bg-[#F1EDFE] p-6 flex flex-col gap-6 text-[#202124]">
      <div>
        <h3 class="text-xl font-bold mb-1">Summary</h3>
        <p class="text-sm">of your Monthly Surprise Box</p>
      </div>
      <div class="flex p-4 gap-16 bg-white rounded-lg justify-between lg:justify-start">
        <div>
          <p class="font-bold">Mystery Box</p>
          <p class="text-[#838383] text-xs">X 1</p>
        </div>
        <div class="">
          <p class="font-bold"><span class="font-normal">SAR</span> 456</p>
          <p class="text-[#838383] text-xs">Monthly</p>
        </div>
      </div>
      <div class="space-y-5">
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-black text-sm">Subtotal</span>
            <span class="font-bold"><span class="font-normal">SAR</span> 456</span>
          </div>

          <div class="flex justify-between items-center">
            <span class="text-black text-sm">Shipping</span>
            <span class="text-[#707070]">Free</span>
          </div>

          <div class="flex justify-between items-center">
            <span class="text-black text-sm">Taxes</span>
            <span class="font-bold"><span class="font-normal">SAR</span> 4.0</span>
          </div>
        </div>

        <div class="flex justify-between items-center pt-4 border-t border-[#D1C5FB]">
          <span class="font-semibold">Total</span>
          <div class="text-right">
            <p class="font-bold"><span class="font-normal">SAR</span> 456</p>
            <span class="text-xs text-[#838383]">Monthly</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>